# Django
## Form 
### Django Form 
### HTML Form의 한계
- 지금까지 사용자로부터 데이터를 제출 받기 위해 활용한 방법
- 그러나 비정상적 혹은 악의적인 요청을 필터링 할 수 없음

=> 따라서 유효한 데이터인지에 대한 확인이 필요함

### 유효성 검사
- 수집한 데이터가 정확하고 유효한지 확인하는 과정
- Django Form의 유효성 검사는 사용자가 입력한 데이터가 올바른 형식인지 자동으로 점검하는 기능을 제공
- 예를 들어, 필수 입력 값이 비어 있거나 잘못된 이메일 형식을 입력하면 오류를 알려줌
- 이 과정을 통해 서버에 잘못된 데이터가 저장되지 않도록 보호할 수 있음

### 유효성 검사 구현의 어려움
- 유효성 검사를 구현하기 위해서는 입력 값, 형식, 중복, 보안 등 많은 것들을 고려해야 함
- 이런 과정과 기능을 직접 개발하는 것이 아닌 Django가 제공하는 Form을 사용

---

## Form Class
### Django Form의 기능
- 사용자 입력 데이터를 수집하고, 처리 및 유효셩 검사를 수행하기 위한 도구
* 유효성 검사를 단순화하고 자동화 할 수 있는 기능을 제공
* 사용자가 잘못 입력한 데이터는 자동으로 오류로 처리되어 안정성을 높임
* 개발자는 이를 통해 빠르고 일관된 입력 검증 기능을 구현할 수 있음

### Form Class 정의
- Form Class를 상속받아 내용과 제목에 대한 사용자 입력을 받는 `ArticleForm`을 정의하는 방법

```python
# articles/forms.py

from django import forms

class ArticleForm(forms.Form):
    title = forms.CharField(max_length=10)
    content = forms.CharField()
```

### From Class를 적용한 new logic(1)
- view 함수 new 변경

```python
# articles/views.py

from .forms import ArticleForm

def new(request):
  form = ArticleForm()
  context = {
    'form' : form 
  }

  return render(request, 'articles/new.html', context)
```

### From Class를 적용한 new logic(2)
- new 페이지에서 form 인스턴스 출력

```html
<!-- articles/new.html -->

<h1>New</h1>
<form action="{% url 'articles:create' %}" method="POST">
  {% csrf token %}
  {{ form  }}
  <input type="submit">
</form>
```

---

# 📌 Django Form Field 클래스 정리

## 1️⃣ 텍스트 입력 계열

| 필드           | 설명                              | 기본 위젯        |
| ------------ | ------------------------------- | ------------ |
| `CharField`  | 짧은 문자열 입력 (기본)                  | `TextInput`  |
| `EmailField` | 이메일 형식 검증                       | `EmailInput` |
| `RegexField` | 정규식 패턴과 매칭되는 문자열만 허용            | `TextInput`  |
| `SlugField`  | 슬러그(`a-z`, `0-9`, `_`, `-`)만 허용 | `TextInput`  |
| `URLField`   | URL 형식 검증                       | `URLInput`   |
| `UUIDField`  | UUID 형식 문자열 검증                  | `TextInput`  |

---

## 2️⃣ 숫자 입력 계열

| 필드             | 설명        | 기본 위젯         |
| -------------- | --------- | ------------- |
| `IntegerField` | 정수 입력     | `NumberInput` |
| `FloatField`   | 부동소수 입력   | `NumberInput` |
| `DecimalField` | 고정 소수점 입력 | `NumberInput` |

---

## 3️⃣ 불리언 / 선택 계열

| 필드                         | 설명                                                               | 기본 위젯            |
| -------------------------- | ---------------------------------------------------------------- | ---------------- |
| `BooleanField`             | True/False 입력                                                    | `CheckboxInput`  |
| `NullBooleanField`         | True/False/Unknown 입력 (deprecated, 대신 `BooleanField(null=True)`) | `Select`         |
| `ChoiceField`              | 지정된 선택지 중 하나                                                     | `Select`         |
| `MultipleChoiceField`      | 여러 개 선택 가능                                                       | `SelectMultiple` |
| `TypedChoiceField`         | ChoiceField + 형 변환                                               | `Select`         |
| `TypedMultipleChoiceField` | MultipleChoiceField + 형 변환                                       | `SelectMultiple` |

---

## 4️⃣ 날짜 / 시간 계열

| 필드              | 설명                         | 기본 위젯           |
| --------------- | -------------------------- | --------------- |
| `DateField`     | 날짜 (YYYY-MM-DD)            | `DateInput`     |
| `TimeField`     | 시간 (HH:MM)                 | `TimeInput`     |
| `DateTimeField` | 날짜 + 시간                    | `DateTimeInput` |
| `DurationField` | 시간 간격 (Python `timedelta`) | `TextInput`     |

---

## 5️⃣ 파일 업로드 계열

| 필드           | 설명                     | 기본 위젯                |
| ------------ | ---------------------- | -------------------- |
| `FileField`  | 일반 파일 업로드              | `ClearableFileInput` |
| `ImageField` | 이미지 파일 업로드 (Pillow 필요) | `ClearableFileInput` |

---

## 6️⃣ 기타 특수 필드

| 필드                      | 설명                       | 기본 위젯         |
| ----------------------- | ------------------------ | ------------- |
| `GenericIPAddressField` | IPv4 / IPv6 주소           | `TextInput`   |
| `JSONField`             | JSON 구조 검증 (Django 3.1+) | `Textarea`    |
| `ComboField`            | 여러 필드 검증 조합              | 지정된 하위 필드 위젯  |
| `MultiValueField`       | 여러 입력값을 하나로 묶음           | `MultiWidget` |

---

# 📌 요약

* **문자열** → `CharField`, `EmailField`, `URLField` …
* **숫자** → `IntegerField`, `FloatField`, `DecimalField`
* **선택** → `ChoiceField`, `MultipleChoiceField`, `BooleanField`
* **날짜/시간** → `DateField`, `DateTimeField`, `TimeField`
* **파일** → `FileField`, `ImageField`
* **특수** → `UUIDField`, `IPAddressField`, `JSONField` 등


---


## Widgets
- HTML 'input' element의 표현을 담당
- Django Form의 widgets은 각 필드가 HTML에서 어떻게 렌더링 될 지를 결정
- 예를 들어, TextInput, Select, CheckboxInput 등 다양한 위젯 클래스를 사용해 입력 방식과 속성을 세부 조정할 수 있음

### Widget 적용
- Widget은 단순히 input 요소의 속성 및 출력되는 부분을 변경하는 것 

```python
# articles/forms.py

from django import forms

class ArticleForm(forms.form):
  title = forms.CharField(max_length=10)
  content = forms.CharField(widget=forms.Textarea)
```

---

# 📌 Django Form 위젯 정리

## 1. 텍스트 입력 계열

| 위젯                    | 설명                | HTML 태그                   | 예시                                                         |
| --------------------- | ----------------- | ------------------------- | ---------------------------------------------------------- |
| `forms.TextInput`     | 한 줄 텍스트 입력        | `<input type="text">`     | `forms.CharField(widget=forms.TextInput())`                |
| `forms.PasswordInput` | 비밀번호 입력 (**** 처리) | `<input type="password">` | `forms.CharField(widget=forms.PasswordInput())`            |
| `forms.EmailInput`    | 이메일 입력            | `<input type="email">`    | `forms.EmailField(widget=forms.EmailInput())`              |
| `forms.URLInput`      | URL 입력            | `<input type="url">`      | `forms.URLField(widget=forms.URLInput())`                  |
| `forms.NumberInput`   | 숫자 입력             | `<input type="number">`   | `forms.IntegerField(widget=forms.NumberInput())`           |
| `forms.Textarea`      | 여러 줄 텍스트          | `<textarea>`              | `forms.CharField(widget=forms.Textarea(attrs={'rows':5}))` |

---

## 2. 선택 계열

| 위젯                             | 설명         | HTML 태그                   | 예시                                                                 |
| ------------------------------ | ---------- | ------------------------- | ------------------------------------------------------------------ |
| `forms.Select`                 | 단일 선택 드롭다운 | `<select>`                | `forms.ChoiceField(widget=forms.Select(), choices=...)`            |
| `forms.SelectMultiple`         | 다중 선택 드롭다운 | `<select multiple>`       | `forms.MultipleChoiceField(widget=forms.SelectMultiple())`         |
| `forms.RadioSelect`            | 라디오 버튼     | `<input type="radio">`    | `forms.ChoiceField(widget=forms.RadioSelect(), choices=...)`       |
| `forms.CheckboxSelectMultiple` | 체크박스 여러 개  | `<input type="checkbox">` | `forms.MultipleChoiceField(widget=forms.CheckboxSelectMultiple())` |

---

## 3. 불리언/체크 계열

| 위젯                    | 설명          | HTML 태그                   | 예시                                                 |
| --------------------- | ----------- | ------------------------- | -------------------------------------------------- |
| `forms.CheckboxInput` | 체크박스 (참/거짓) | `<input type="checkbox">` | `forms.BooleanField(widget=forms.CheckboxInput())` |

---

## 4. 날짜/시간 계열

| 위젯                    | 설명      | HTML 태그                         | 예시                                                                                 |
| --------------------- | ------- | ------------------------------- | ---------------------------------------------------------------------------------- |
| `forms.DateInput`     | 날짜 선택   | `<input type="date">`           | `forms.DateField(widget=forms.DateInput(attrs={'type':'date'}))`                   |
| `forms.TimeInput`     | 시간 선택   | `<input type="time">`           | `forms.TimeField(widget=forms.TimeInput(attrs={'type':'time'}))`                   |
| `forms.DateTimeInput` | 날짜 + 시간 | `<input type="datetime-local">` | `forms.DateTimeField(widget=forms.DateTimeInput(attrs={'type':'datetime-local'}))` |

---

## 5. 파일 업로드

| 위젯                         | 설명             | HTML 태그                         | 예시                                                    |
| -------------------------- | -------------- | ------------------------------- | ----------------------------------------------------- |
| `forms.FileInput`          | 파일 업로드         | `<input type="file">`           | `forms.FileField(widget=forms.FileInput())`           |
| `forms.ClearableFileInput` | 기존 파일 삭제 옵션 포함 | `<input type="file"> + 삭제 체크박스` | `forms.ImageField(widget=forms.ClearableFileInput())` |

---

# 📌 위젯 속성(attrs) 예시

위젯에는 `attrs` 딕셔너리로 HTML 속성을 추가할 수 있어요.

```python
title = forms.CharField(
    widget=forms.TextInput(
        attrs={
            'class': 'form-control',     # Bootstrap 스타일
            'placeholder': '제목을 입력하세요',
            'maxlength': '50'
        }
    )
)
```

---

## Django ModelForm
### Form vs ModelForm 
* Form
: 사용자 입력 데이터를 DB에 저장하지 않을 때(ex. 검색, 로그인)

* ModelForm
: 사용자 입력 데이터를 DB에 저장해야 할 때(ex. 게시글 작성, 회원가입)

### ModelForm 기능
- Model과 연결된 Form을 자동으로 생성해주는 기능을 제공
- ModelForm은 Form 클래스와 Model 클래스를 결합한 형태로, 모델 필드를 기반으로 입력 폼을 자동 생성해줌
- 데이터 수집과 저장 과정을 동시에 처리할 수 있도록 도와줌

### ModelForm Class 정의 
- 기존 ArticleForm 클래스 수정

```python
# articles/forms.py

from django import forms
from .models import Article

class ArticleForm(forms.ModelForm):
  class Meta:
    model = Article
    fields = '__all__'
```

--- 

## Meta class 
- ModelForm 정보를 작성하는 곳
- Meta class는 ModelForm 내부에서 어떤 모델과 연결할지, 어떤 필드를 사용할지 등을 정의하는 설정 공간
- 폼의 동작 방식을 제어하는 핵심 역할을 함

### 'fields' 및 'exclude' 속성
- exclude 속성을 사용하여 모델에서 포함되지 않도록 필드를 지정할 수 있음

```python 
# articles/forms.py

class ArticleForm(forms.ModelForm):
  class Meta:
    model = Article
    fields = ('title',) # fileds에 있는 요소만 사용하게 됨
```

```python 
# articles/forms.py

class ArticleForm(forms.ModelForm):
  class Meta:
    model = Article 
    exculde = ('title',) # exclude에 있는 요소를 제거함 
```

### Meta class 주의사항
- Django에서 ModelForm에 대한 추가 정보나 속성을 작성하는 클래스 구조를 Meta 클래스로 작성 했을 뿐이며, 파이선의 inner class와 같은 문법적인 관점으로 접근하지 말 것 

---

## ModelForm 적용
### MdoelForm을 적용한 create 로직 

```python
# articles/views.py

from .forms import ArticleForm

def create(request):
    form = ArticleForm(request.POST)
    if form.is_valid():
        article = form.save()
        return redirect('articles:detail', article.pk)
    context = {
        'form': form,
    }
    return render(request, 'articles/new.html', context)
```

### is_vaild() 활용
- 여러 유효성 검사를 실행하고, 데이터가 유효한지 여부를 Boolean으로 반환


### 공백 데이터가 유효하지 않은 이유와 에러메시지가 출력되는 과정
- 별도로 명시하지 않았지만 모델 필드에는 기본적으로 빈 값은 허용하지 않는 제약조건이 설정되어 있음
- 빈 값은 `is_valid()`에 의해 `False`로 평가되고  
  `form` 객체에는 그에 맞는 에러 메시지가 포함되어 다음 코드로 진행됨


### models.py

```python
# articles/models.py
class Article(models.Model):
    title = models.CharField(max_length=10)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```


### views.py

```python
# articles/views.py
def create(request):
    form = ArticleForm(request.POST)
    if form.is_valid():
        article = form.save()
        return redirect('articles:detail', article.pk)
    context = {
        'form': form,
    }
    return render(request, 'articles/new.html', context)
```


### ModelForm을 적용한 edit 로직

### views.py

```python
# articles/views.py
def edit(request, pk):
    article = Article.objects.get(pk=pk)
    form = ArticleForm(instance=article)
    context = {
        'article': article,
        'form': form,
    }
    return render(request, 'articles/edit.html', context)
```

### edit.html

```html
<!-- articles/edit.html -->
<h1>EDIT</h1>
<form action="{% url 'articles:update' article.pk %}" method="POST">
  {% csrf_token %}
  {{ form }}
  <input type="submit">
</form>
```

### ModelForm을 적용한 update 로직

### 📌 views.py

```python
# articles/views.py
def update(request, pk):
    article = Article.objects.get(pk=pk)
    form = ArticleForm(request.POST, instance=article)
    if form.is_valid():
        form.save()
        return redirect('articles:detail', article.pk)
    context = {
        'article': article,
        'form': form,
    }
    return render(request, 'articles/edit.html', context)
```

---

## save 메서드
### save()
- 데이터베이스 객체를 만들고 저장하는 ModelForm의 인스턴스 메서드
- 폼 데이터가 유효한 경우, save() 메서드를 호출하면 모델 인스턴스를 생성하고 데이터베이스에서 저장됨
- instance 인자를 통해 새 객체 생성과 기존 객체 수정도 구분할 수 있음
- 이 과정을 통해 코드 없이 손쉽게 DB 연동이 가능함

### save() 메서드가 생성과 수정을 구분하는 법
- 키워드 인자 instance 여부를 통해 생성할 지, 수정할 지를 결정

```python 
# CREATE
form = ArticleForm(request.POST)
form.save()
```

```python 
form = ArticleForm(request.POST, instance=article)
form.save()
```

### Django Form 정리
- 사용자로부터 데이터를 수집하고 처리하기 위한 강력하고 유연한 도구
- HTML form의 생성, 데이터 유효성 검사 및 처리를 쉽게 할 수 있도록 도움

---

## HTTP 요청 다루기
### View 함수 구조 변화
### new & create view 함수간 공통점과 차이점
* 공통점
`" 데이터 생성을 구현하기 위함 "`

* 차이점
`" new는 GET method 요청만을, create는 POST method 요청만을 처리 "`

### view 함수 구조화의 목적
=> HTTP request method 차이점을 활용해 동일한 목적을 가지는 2개의 view 함수를 하나로 구조화

---

### new & create 함수 결합

### 기존 코드

```python
def new(request):
    form = ArticleForm()
    context = {
        'form': form,
    }
    return render(request, 'articles/new.html', context)
```

```python
def create(request):
    form = ArticleForm(request.POST)
    if form.is_valid():
        article = form.save()
        return redirect('articles:detail', article.pk)
    context = {
        'form': form,
    }
    return render(request, 'articles/new.html', context)
```

### 결합된 코드
- new와 create view 함수의 공통점과 차이점을 기반으로 하나의 함수로 결합
- 두 함수의 유일한 차이점이었던 request method에 따른 분기
- POST일 때는 과거 create 함수 구조였던 객체 생성 및 저장 로직 처리 
- POST가 아닐 때는 과거 new 함수에서 진행했던 form 인스턴스 생성
- context에 담기는 form은
  1. is_vaild()를 통과하지 못해 에러메시지를 담은 form이거나
  2. else문을 통한 form 인스턴스

```python
def create(request):
    if request.method == 'POST':
        form = ArticleForm(request.POST)
        if form.is_valid():
            article = form.save() # model form을 써야만 save가 가능함
            return redirect('articles:detail', article.pk)
    else:
        form = ArticleForm()
    
    context = {
        'form': form,
    }
    return render(request, 'articles/new.html', context)
```

### request method에 따른 요청의 변화
(GET) articles/create/ 게시글 페이지를 줘!
(POST) articles/create/ 게시글을 생성해줘!


---

## edit & update 함수 결합

### 새로운 update view 함수
- 기존 edit과 update view 함수 결합

### views.py

```python
# articles/views.py
def update(request, pk):
    article = Article.objects.get(pk=pk)

    if request.method == 'POST':   # update
        form = ArticleForm(request.POST, instance=article)
        if form.is_valid():
            form.save()
            return redirect('articles:detail', article.pk)
    else:   # edit
        form = ArticleForm(instance=article)

    context = {
        'article': article,
        'form': form,
    }
    return render(request, 'articles/update.html', context)
```

---

## ModelForm의 키워드 인자 구성
### ModelForm 키워드 인자 data와 instance 살펴보기

- **data**는 첫 번째에 위치한 키워드 인자이기 때문에 생략 가능  
- **instance**는 9번째에 위치한 키워드 인자이기 때문에 생략할 수 없음  

### ModelForm의 상위 클래스인 BaseModelForm의 생성자 함수 모습

```python
class BaseModelForm(BaseForm):
    def __init__(self, data=None, files=None, auto_id='id_%s', prefix=None,
                 initial=None, error_class=ErrorList, label_suffix=None,
                 empty_permitted=False, instance=None, use_required_attribute=None,
                 renderer=None):
        ...
```

### views.py 예시

```python
# articles/views.py
form = ArticleForm(request.POST, instance=article)
```

---

## Widgets 응용
### forms.py

```python
# articles/forms.py

class ArticleForm(forms.ModelForm):
    title = forms.CharField(
        label='제목',
        widget=forms.TextInput(
            attrs={
                'class': 'my-title',
                'placeholder': 'Enter the title',
            }
        ),
    )

    class Meta:
        model = Article
        fields = '__all__'
```

### forms.py

```python
class ArticleForm(forms.ModelForm):
    title = forms.CharField(
        label='제목',
        widget=forms.TextInput(
            attrs={
                'class': 'my-title',
                'placeholder': 'Enter the title',
                'maxlength': 10,
            }
        ),
    )

    content = forms.CharField(
        label='내용',
        widget=forms.Textarea(
            attrs={
                'class': 'my-content',
                'placeholder': 'Enter the content',
                'rows': 5,
                'cols': 50,
            }
        ),
        error_messages={'required': '내용을 입력해주세요.'},
    )
```

---

## 필드를 수동으로 렌더링

```html
{{ form.non_field_errors }}
<form action="..." method="POST">
  {% csrf_token %}
  
  <div>
    {{ form.title.errors }}
    <label for="{{ form.title.id_for_label }}">Title:</label>
    {{ form.title }}
  </div>

  <div>
    {{ form.content.errors }}
    <label for="{{ form.content.id_for_label }}">Content:</label>
    {{ form.content }}
  </div>

  <input type="submit">
</form>
```

### 여기서 핵심은:  
- `{{ form.non_field_errors }}` → 특정 필드가 아닌 폼 전체 에러  
- `{{ form.title.errors }}` → title 필드 유효성 검사 에러  
- `{{ form.title.id_for_label }}` → title input 태그와 연결되는 label의 `for` 속성  
- `{{ form.title }}` → 실제 `<input>` 태그  

즉, `{{ form }}` 대신 **필드를 하나하나 수동으로 렌더링**하면 CSS/Bootstrap 디자인을 자유롭게 적용할 수 있어요.  

