# Django
## Model
- 데이터베이스와 Python 클래스(객체)로 추상화된 형태로 상호작용
- Django의 강력한 기능 : 개발자가 데이터베이스에 대한 깊은 지식 없이도 쉽게 데이터 관리 가능
- 유지보수 및 확장성 증대 : 데이터베이스 변경 시에도 코드 수정 최소화, 재사용 가능한 데이터 모델을 통해 개발 효율성 향상

### Model을 통한 DB(데이터베이스) 관리
- urls.py : 사용자 요청의 시작점
- views.py : 요청을 처리하고  models.py를 통해 데이터를 다룸
- models.py : 데이터베이스를 정의하고, 데이터베이스와 상호작용
- templates : views.py로부터 받은 데이터를 사용자에게 보여줄 화면을 구성

---

## Model class
- DB 테이블을 정의하고 데이터를 조작할 수 있는 기능들을 제공
- Model class는 데이터베이스 테이블의 구조를 설게하는 청사진 역할을 함
- 어떤 데이터(컬럼)을 저장할지, 그 데이터의 형태는 어떠할지(타입, 길이 등)를 Python 코드로 명확히 정의함

### Model 클래스 살펴보기
* id 필드는 Django가 자동 생성
- django.db.models 모듈의 Model이라는 부모 클래스를 상속받음
  - Model은 model에 관련된 모든 코드가 이미 작성 되어있는 Class
    - 개발자는 가장 중요한 **테이블 구조를 어떻게 설계할지에 대한 코드만 작성하도록** 하기 위한 것 ("상속"을 활용한 프레임워크의 기능 제공)

- 클래스 변수명
  - 테이블의 각 "필드(열) 이름"
  
- Model Field
  - 데이터베이스 테이블의 열(Column)을 나타내는 중요한 구성 요소
  - "데이터의 유형"과 "제약 조건"을 정의

* CharField의 max_length 매개변수를 지정하는 것은 선택 사항
* SQLite는 문자열 컬럼의 길이에 대한 엄격한 제한을 강제하지 않기 때문
* 하지만 유효셩 검사 및 컬럼에 들어갈 데이터의 명확성을 위해 명시적으로 설정하는 것은 매우 권장됨

---

## Model Field
- DB 테이블의 필드(열) 정의
- 데이터 타입 및 제약 조건 명시

- Django는 이러한 필드 정의를 바탕으로 데이터베이스 컬럼을 자동으로 생성하고 데이터 입력 시 유효성 검사 등 필요한 기능을 제공
- 정확한 필드 정의는 애플리케이션의 안정성을 높이는데 필수적임


---

### 📌 Django 모델 필드 정리표

| Django 필드                                  | 대응되는 DB 타입            | 설명                                            |
| ------------------------------------------ | --------------------- | --------------------------------------------- |
| `CharField(max_length=n)`                  | VARCHAR(n)            | 짧은 문자열 저장                                     |
| `TextField`                                | TEXT                  | 긴 문자열 저장                                      |
| `IntegerField`                             | INT                   | 일반 정수                                         |
| `SmallIntegerField`                        | SMALLINT              | 작은 범위 정수                                      |
| `BigIntegerField`                          | BIGINT                | 큰 범위 정수                                       |
| `PositiveIntegerField`                     | INT (unsigned)        | 음수가 없는 정수                                     |
| `FloatField`                               | FLOAT / REAL          | 부동 소수점                                        |
| `DecimalField(max_digits, decimal_places)` | DECIMAL / NUMERIC     | 정확한 소수 (금액 계산 적합)                             |
| `BooleanField`                             | BOOLEAN / TINYINT(1)  | True/False 값                                  |
| `DateField`                                | DATE                  | 날짜(연-월-일)                                     |
| `TimeField`                                | TIME                  | 시간(HH\:MM\:SS)                                |
| `DateTimeField`                            | DATETIME / TIMESTAMP  | 날짜 + 시간                                       |
| `AutoField`                                | INT (AUTO\_INCREMENT) | 자동 증가 정수 (PK)                                 |
| `UUIDField`                                | CHAR(32) / UUID       | UUID 값 저장                                     |
| `BinaryField`                              | BLOB / BYTEA          | 이진 데이터 저장                                     |
| `EmailField`                               | VARCHAR               | 이메일 형식 검증 포함                                  |
| `URLField`                                 | VARCHAR               | URL 형식 검증 포함                                  |
| `SlugField`                                | VARCHAR               | URL-friendly 텍스트                              |
| `FileField`                                | VARCHAR (경로저장)        | 파일 업로드 경로 저장                                  |
| `ImageField`                               | VARCHAR (경로저장)        | 이미지 업로드 경로 저장 (Pillow 필요)                     |
| `JSONField`                                | JSON / TEXT           | JSON 데이터 저장 (PostgreSQL, MySQL, SQLite 일부 지원) |
| `ForeignKey`                               | 외래 키(FK)              | 다른 테이블과 1\:N 관계                               |
| `OneToOneField`                            | UNIQUE FK             | 다른 테이블과 1:1 관계                                |
| `ManyToManyField`                          | 중간 테이블 생성             | N\:M 관계                                       |

---

### Model Field
1. Field types(필드 유형)
- 데이터베이스에 저장될 "데이터의 종류"를 정의

2. Field options(필드 옵션)
-  필드의 "동작"과 "제약 조건"을 정의 

---

## Field types
- 데이터베이스에 저장될 "데이터의 종류"를 정의
(models 모듈의 클래스로 정의되어 있음)

### CharField()
- 제한된 길이의 문자열을 저장
- 필드의 최대 길이를 결정하는 max_length는 선택 옵션

### TextField()
- 길이 제한이 없는 대용량 텍스트를 저장
- 무한대는 아니며 사용하는 시스템에 따라 달라짐

### 주요 필드 유형
- 문자열 필드
  - CharField, TextField

- 숫자 필드
  - IntegerField, FloatField

- 날짜/시간 필드 
  - DateField, TimeField, DateTimeField

- 파일 관련 필드
  - FileField, ImageField

--- 

## Field options
- 필드의 동작과 제약조건을 정의

### 제약 조건(Constraint)
- 특정 규칙을 강제하기 위해 테이블의 열이나 행에 적용되는 규칙이나 제한사항

### 주요 필드 옵션
- null 
  - 데이터베이스에서 NULL 값을 허용할지 여부를 결정(기본값 : False)

- blank
  - form에서 빈 값을 허용할지 여부를 결정(기본값 : False)

- default
  - 필드의 기본값을 설정

---

### 📌 Django 모델 필드 정리표

| 옵션                                   | 설명                                  | DB에서의 의미       |
| ------------------------------------ | ----------------------------------- | -------------- |
| `null=True`                          | DB에 `NULL` 허용                       | `NULL` 가능      |
| `null=False` (기본값)                   | DB에 `NOT NULL`                      | 반드시 값 필요       |
| `blank=True`                         | 폼/유효성 검사에서 빈 값 허용 (DB `NULL`과는 다름)  | 폼 레벨 제약        |
| `unique=True`                        | 해당 필드 값은 테이블 내에서 유일해야 함             | `UNIQUE` 제약    |
| `primary_key=True`                   | 기본 키로 지정 (자동 `unique` + `not null`) | `PRIMARY KEY`  |
| `default=값`                          | 값이 없을 때 기본값 저장                      | `DEFAULT`      |
| `choices=[(v1, "라벨1"), (v2, "라벨2")]` | 값의 선택지를 제한                          | ENUM 유사        |
| `max_length=n`                       | 문자열 최대 길이 지정                        | VARCHAR(n) 제약  |
| `db_index=True`                      | 해당 필드에 인덱스 생성                       | `INDEX` 생성     |
| `unique_for_date`                    | 특정 날짜 단위에서 유일해야 함                   | DB에서 복합 유니크 제약 |
| `unique_for_month`                   | 특정 월 단위에서 유일해야 함                    | DB에서 복합 유니크 제약 |
| `unique_for_year`                    | 특정 연 단위에서 유일해야 함                    | DB에서 복합 유니크 제약 |

---

## Migrations
- model 클래스의 변경사항(필드 생성, 수정 삭제 등)을 DB에 최종 반영하는 방법
- 모든 변경 사항이 코드로 관리되어 협업 시 모델 변경 내역에 대한 추적과 공유가 수월함


### Django 모델 클래스와 Migration 과정 정리

### 1. 모델 클래스 정의/수정

* Django에서는 **Python 클래스**로 DB 모델을 정의
* 예:

  ```python
  # articles/models.py
  class Article(models.Model):
      title = models.CharField(max_length=10)   # 짧은 문자열
      content = models.TextField()              # 긴 텍스트
  ```


### 2. 마이그레이션 파일 생성

* 모델 변경을 감지하고 **설계도(Migration 파일)** 생성
* 명령어:

  ```bash
  $ python manage.py makemigrations
  ```
* 결과:
  `articles/migrations/0001_initial.py` 파일 생성됨
  → DB 변경사항(모델 정의)을 기록한 Python 코드


### 3. 마이그레이션(DB 반영)

* 생성된 마이그레이션 파일을 실제 DB에 적용
* 명령어:

  ```bash
  $ python manage.py migrate
  ```
* 과정:
  Python 코드 → SQL 쿼리문으로 변환 → DB 실행


### 핵심 개념

* **makemigrations**: 모델 변경사항을 감지해 **설계도 파일 생성**
* **migrate**: 설계도를 실제 **DB에 반영(SQL 실행)**
* **migration 파일**: 모델 변경 내역을 순차적으로 저장 및 관리 (버전 관리처럼 추적 가능)


**모델 정의(클래스)** → **makemigrations(설계도 생성)** → **migrate(DB 적용)** 순서로 진행됨



### Migratoins 핵심 명령어 2가지
- $ python manage.py makemigrations
-> 역할 : model class를 기반으로 최종 설계도(migration)을 작성

- $ python manage.py migration
-> 역할 : 최정 설계도를 DB에 전달하여 반영

* 마이그레이션 파일은 되도록이면 직접 건들이지 말기
* migrations 폴더에 자도으로 생성된 파일들은 직접 수정하거나 삭제하지 않는 것이 원칙



### Migration 경고 메시지

* Django 서버를 시작할 때 출력되는 migration 관련 경고 메시지
* **미적용 마이그레이션 파일**이 있을 때 나타남

```bash
$ python manage.py runserver
Watching for file changes with StatReloader
Performing system checks...

System check identified no issues (0 silenced).

You have 18 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.
Run 'python manage.py migrate' to apply them.
```


### 해결방법

* 경고 메시지에 명시된 대로 아래 명령어 실행

  ```bash
  python manage.py migrate
  ```

### 중요한 이유

* 최신 모델 변경 사항이 **데이터베이스에 반영되지 않으면**
  프로젝트가 제대로 작동하지 않을 수 있음

=> **서버 실행 시 "unapplied migration" 경고가 뜨면 → `python manage.py migrate` 실행으로 해결!**


---


## 추가 Migrations
### 이미 생성된 테이블에 필드를 추가해야 한다면 ?
- 이미 기존 테이블이 존재하는 경우, 새 필드를 추가할 때 문제가 발생할 수 있음 
  - 기존에 레코드가 있는 테이블에 새로운 필드를 추가하면 어떤 값으로 채울지 결정해야 함
  - Django의 makemigrations 실행 시 기본값 설정을 요구하는 프롬프트가 표시됨 


### Django Migration 과정 (추가 필드 작성)

### 1. 모델 클래스 수정

* 기존 모델에 새로운 필드 추가
* 예시:

  ```python
  class Article(models.Model):
      title = models.CharField(max_length=10)
      content = models.TextField()
      created_at = models.DateTimeField(auto_now_add=True)  # 최초 생성 시 자동 저장
      updated_at = models.DateTimeField(auto_now=True)      # 수정될 때마다 자동 갱신
  ```

---

### 2. DateTimeField 옵션

* `auto_now` : 데이터가 **저장될 때마다** 현재 시간 저장
* `auto_now_add` : 데이터가 **처음 생성될 때만** 현재 시간 저장

---

### 3. makemigrations 실행

* 명령어:

  ```bash
  $ python manage.py makemigrations
  ```
* 기존 테이블에 새로운 필드를 추가할 때 → 기본값(default) 필요
* 선택지:

  1. **일회성 기본값 입력** (모든 기존 행에 적용)
  2. models.py에서 `default=` 옵션 추가 후 다시 실행

---

### 4. 기본값 입력 상황

* Django가 제안하는 기본값(`timezone.now`)을 사용하는 것을 권장
* 아무것도 입력하지 않고 Enter → 자동으로 Django 기본값 사용됨

---

### 5. migration 파일 생성

* 새 migration 파일이 추가로 생성됨
* Django는 **설계도를 버전별로 누적 관리** → 추후 문제 발생 시 되돌리기 가능
  (Git의 commit과 유사)

---

### 6. migrate 실행

* 명령어:

  ```bash
  $ python manage.py migrate
  ```
* DB에 실제 반영 → 새 필드(`created_at`, `updated_at`)가 테이블에 추가됨

---

### 언제 Migration이 필요한가?

* **모델 클래스에 변경사항이 생겼을 때**

  1. 모델 클래스 생성/수정
  2. `makemigrations` (설계도 생성)
  3. `migrate` (DB 반영)

---

**모델 수정 → makemigrations → migrate → DB 반영**
이 과정을 통해 Django 모델 변경 사항이 DB에 동기화됨


---

## Admin site
### 관리자 인터페이스(Automatic admin interface)
- Django가 추가 설치 및 설정 없이 자동으로 제공하는 관리자 인터페이스
- Django 관리자 인터페이스는 추가 설정 없이 자동 생성되는 웹 기반 관리 도구
- 주요 기능 : 데이터베이스 모델의 CRUD 작업을 간편하게 수행할 수 있음
- 활용 : 빠른 프로토타이핑, 비개발자 데이터 관리, 내부 시스템 구축에 이상적임

### 1. Django admin 계정 생성
1. 터미널 열기 
  - Django 프로젝트 폴더로 이동해서 터미늘얼 엶(manage.py 파일이 있는 위치에서 진행하면 됨)

2. 관리자 계정 생성 명령어 입력
  - $ python manage.py createsuperuser

3. 정보 입력
- 사용자 이름(username) : 관리자 페이지에 로그인할 때 사용할 아이디를 입력
- 이메일(email address) : 선택 사항이라 입력하지 않고 엔터를 눌러 넘어가도 됨
- 비밀번호(password) : 르고인할 때 사용할 비밀번호 입력(비밀번호 입력 시 콘솔창에 아무 것도 나타나지 않음)
- 비밀번호 확인(password(again)) : 비밀번호를 한 번 더 입력해서 확인

4. 관리자 인터페이스 접속 확인
- 로그인 후 아무것도 보이지 않는 것이 정상임
* 우리가 만든 모델을 관리하려면 추가 설정이 필요!

-> admin.py에 작성한 모델 클래스를 등록해야만 admin site에서 확인 가능

```bash
# articles/admin.py
from django.contrib import admin
from .models import Article

admin.site.register(Article)
```